var sdkversion_placeholder="1.25.12";function wrapPluginInitFn(i,t,e){if(t&&(i.plugin_name=t),e&&i.init){var n=i.init;i.init=function(s,r){if(wrapLogFn(s,i,t),s.readyState&&s.readyState.state>=3||!s.on)return a();function a(){n.call(i,s,r)}s.on(e,a)}}return i}function wrapLogFn(i,t,e){function n(t,n){i.logger?i.logger.msg.apply(i.logger,n).module(e+""||"").level(t).log():i.log&&i.log.apply(i,n)}t.log=function(){n("log",arguments)},t.warn=function(){n("warn",arguments)},t.error=function(){n("error",arguments)}}function createPlugin(i,t,e){return wrapPluginInitFn(i,t,e),i.plugin_version=sdkversion_placeholder,i}function CustomDataBuilder(){this.para={distinct_id:null,is_login_id:!1,server_url:"",send_type:"beacon",login_id:null},this.log=console&&console.log||function(){},this.sd=null,this.identities={}}CustomDataBuilder.prototype.initPara=function(i,t){if(this.sd=i,this.log=i&&i.log||this.log,this.check=i.saEvent.check,this._=i._,this.check({distinct_id:t.distinct_id})&&(this.para.distinct_id=t.distinct_id),!0===t.is_login_id&&(this.para.is_login_id=!0),this._.isString(t.server_url)&&(this.para.server_url=this._.optimizeServerUrl(t.server_url)),""===this.para.server_url){var e=this.sd.para.server_url;this._.isArray(e)?this.para.server_url=e[0]||"":this._.isString(e)&&(this.para.server_url=e)}["image","beacon","ajax"].indexOf(t.send_type)>-1&&(this.para.send_type=t.send_type)},CustomDataBuilder.prototype.init=function(i){if(!i||this.sd)return this.log("CustomDataBuilder Plugin initialization failed."),!1;for(var t in this.sd=i,this.log=i&&i.log||this.log,this.check=i.saEvent.check,this._=i._,emptyFn)this[t]=emptyFn[t]},CustomDataBuilder.prototype.createInstance=function(i){var t=new CustomDataBuilder,e=this._.isObject(i.sensors)?i.sensors:this.sd;if(t.initPara(e,i),!t.para.distinct_id)for(var n in t.log("CustomDataBuilder Plugin initialization failed. parameter [distinct_id] error.",t.para.distinct_id),emptyFn)t[n]=emptyFn[n];return t},CustomDataBuilder.prototype.track=function(i,t){if(this.check({event:i,properties:t})){var e={type:"track",event:i,properties:this._.extend({},this.sd._.info.properties(),{$url:this._.getURL(),$title:document.title,$is_login_id:this.para.is_login_id},t)};this._.isEmptyObject(this.identities)||this._.extend(e,{identities:this.identities}),this.sendEvent(e)}},CustomDataBuilder.prototype.bind=function(i){if(!this._.isObject(i))return this.log("the identities is invalid\uff0cthe identities type must be Object."),!1;var t=0,e={},n=this;this._.each(i,function(i,s){if(!n.check({bindKey:s,bindValue:i}))return!1;e[s]=i,t++}),t<2?this.log("the identities is invalid\uff0cyou should have at least two identities."):(this.para.login_id&&(e.$identity_login_id=this.para.login_id),this._.extend(this.identities,e),this.sendEvent({type:"track_id_bind",event:"$BindID",properties:this._.extend({},this.sd._.info.properties(),{$url:this._.getURL(),$title:document.title,$is_login_id:this.para.is_login_id}),identities:e}))},CustomDataBuilder.prototype.unbind=function(i,t){if(!this.check({unbindKey:i,bindValue:t}))return!1;this.identities[i]&&this.identities[i]===t&&delete this.identities[i];var e={};e[i]=t,this.sendEvent({identities:e,type:"track_id_unbind",event:"$UnbindID",properties:this._.extend({},this.sd._.info.properties(),{$url:this._.getURL(),$title:document.title,$is_login_id:this.para.is_login_id})})},CustomDataBuilder.prototype.setProfile=function(i){if(this.check({propertiesMust:i})){var t={type:"profile_set",properties:this._.extend({},{$is_login_id:this.para.is_login_id},i)};this._.isEmptyObject(this.identities)||this._.extend(t,{identities:this.identities}),this.sendEvent(t)}},CustomDataBuilder.prototype.login=function(i){if(!this.check({distinct_id:i}))return this.log("login_id id is invalid"),!1;if(i!==this.para.distinct_id||this.para.is_login_id){var t={type:"track_signup",event:"$SignUp",original_id:this.para.distinct_id,properties:this._.extend({},this.sd._.info.properties(),{$url:this._.getURL(),$title:document.title,$is_login_id:this.para.is_login_id})};this._.isEmptyObject(this.identities)||this._.extend(t,{identities:this.identities}),this.para.distinct_id=i,this.para.login_id=i,this.sendEvent(t),this.para.is_login_id=!0}else this.log("login id is equal to distinct_id")},CustomDataBuilder.prototype.sendEvent=function(i){var t=this,e=this._,n=this.sd;if(e.isObject(i)){var s={distinct_id:this.para.distinct_id,lib:{$lib:"js",$lib_method:"code",$lib_version:String(n.lib_version)},time:1*new Date};e.extend(s,i),this.formatData(s),s._track_id=Number(String(e.getRandom()).slice(2,5)+String(e.getRandom()).slice(2,4)+String((new Date).getTime()).slice(-4)),s._flush_time=(new Date).getTime(),this.para.server_url||this.log("\u5f53\u524d server_url \u4e3a\u7a7a\u6216\u4e0d\u6b63\u786e\uff0c\u53ea\u5728\u63a7\u5236\u53f0\u6253\u5370\u65e5\u5fd7\uff0cnetwork \u4e2d\u4e0d\u4f1a\u53d1\u6570\u636e\uff0c\u8bf7\u914d\u7f6e\u6b63\u786e\u7684 server_url\uff01"),this.log(s);var r={getInstance:function(i){return"beacon"===t.para.send_type&&e.isSupportBeaconSend()?(i.data=n.kit.encodeTrackData(i.data),new e.BeaconSend(i)):"ajax"===t.para.send_type&&e.isSupportCors()?(i.data=n.kit.encodeTrackData(i.data),new e.AjaxSend(i)):(i.data.time=1*new Date,i.data=(s=i.server_url,r=i.data,a=n.kit.encodeTrackData(r),-1!==s.indexOf("?")?s+"&"+a:s+"?"+a),new e.ImageSend(i));var s,r,a},sendCall:function(i){r.getInstance(i).start()}};if(this.para.server_url){var a={data:s,server_url:this.para.server_url};r.sendCall(a)}}else this.log("data is invalid")},CustomDataBuilder.prototype.formatData=function(i){var t,e,n=i.properties,s=this,r=this._,a=function(){s.sd.logger.msg.apply(s.sd,arguments).level("warn").log()};!function(i){var t=i.properties,e=JSON.parse(JSON.stringify(i));r.isObject(t)&&r.each(t,function(i,n){if(r.isFunction(i))try{t[n]=i(e),r.isFunction(t[n])&&(a("\u60a8\u7684\u5c5e\u6027- "+n+" \u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664"),delete t[n])}catch(s){delete t[n],a("\u60a8\u7684\u5c5e\u6027- "+n+" \u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664")}})}(i),this._.searchObjDate(i),r.isObject(n)?(!function(i,t){r.isObject(i)&&r.each(i,function(e,n){if(r.isArray(e)){var s=[];r.each(e,function(i){if(r.isString(i))s.push(i);else if(r.isUndefined(i))s.push("null");else try{s.push(JSON.stringify(i))}catch(t){a("\u60a8\u7684\u6570\u636e-",n,e,"\u6570\u7ec4\u91cc\u503c\u6709\u9519\u8bef,\u5df2\u5c06\u5176\u5220\u9664")}}),i[n]=s}var o=r.indexOf(t||[],n)>-1;if(r.isObject(e)&&"$option"!==n&&!o)try{i[n]=JSON.stringify(e)}catch(d){delete i[n],a("\u60a8\u7684\u6570\u636e-",n,e,"\u6570\u636e\u503c\u6709\u9519\u8bef\uff0c\u5df2\u5c06\u5176\u5220\u9664")}else r.isString(e)||r.isNumber(e)||r.isDate(e)||r.isBoolean(e)||r.isArray(e)||r.isFunction(e)||"$option"===n||o||(a("\u60a8\u7684\u6570\u636e-",n,e,"-\u683c\u5f0f\u4e0d\u6ee1\u8db3\u8981\u6c42\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664"),delete i[n])})}(n),t=n,r.isObject(t)&&r.each(["distinct_id","user_id","id","date","datetime","event","events","first_id","original_id","device_id","properties","second_id","time","users"],function(i,n){i in t&&(r.indexOf(e||[],i)>-1||(n<3?(delete t[i],a("\u60a8\u7684\u5c5e\u6027- "+i+"\u662f\u4fdd\u7559\u5b57\u6bb5\uff0c\u6211\u4eec\u5df2\u7ecf\u5c06\u5176\u5220\u9664")):a("\u60a8\u7684\u5c5e\u6027- "+i+"\u662f\u4fdd\u7559\u5b57\u6bb5\uff0c\u8bf7\u907f\u514d\u5176\u4f5c\u4e3a\u5c5e\u6027\u540d")))}),function(i){"undefined"!=typeof i.properties.$project&&(i.project=i.properties.$project,delete i.properties.$project),"undefined"!=typeof i.properties.$token&&(i.token=i.properties.$token,delete i.properties.$token)}(i),function(i,t){r.each(i,function(e,n){-1===r.indexOf(t||[],n)&&s.check({propertyKey:n},function(t,e,s){return t||"keyLength"===s||delete i[n],!0})})}(n),function o(i){var t=["$element_selector","$element_path"],e=["sensorsdata_app_visual_properties"];r.isObject(i)&&r.each(i,function(n,d){if(r.isObject(n))o(i[d]);else if(r.isString(n)){if(r.indexOf(e,d)>-1)return;i[d]=(l=n,c=r.indexOf(t,d)>-1?1024:s.sd.para.max_string_length,r.isNumber(c)&&l.length>c?(a("\u5b57\u7b26\u4e32\u957f\u5ea6\u8d85\u8fc7\u9650\u5236\uff0c\u5df2\u7ecf\u505a\u622a\u53d6--"+l),l.slice(0,c)):l)}var l,c})}(n)):"properties"in i&&(i.properties={}),function(i){if("item_type"in i){var t=i.item_type;s.check({item_type:t},function(t){return t||delete i.item_type,!0})}if("item_id"in i){var e=i.item_id;s.check({item_id:e},function(t,e,n){return t||"string"!==n||delete i.item_id,!0})}}(i)};var emptyFn={track:function(){},register:function(){},bind:function(){},unbind:function(){},sendEvent:function(){},setProfile:function(){},login:function(){}},instance=new CustomDataBuilder,index=createPlugin(instance,"CustomDataBuilder","sdkAfterInitPara");export default index;